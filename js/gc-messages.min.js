"use strict";const gcMessagesLocales={en:{options:{title:"Messages"},table:{header:{timestamp:"Time",code:"Code",description:"Description",content:"Content",priority:"Priority"},nodata:"Sorry, no messages available!"}},de:{options:{title:"Ereignisse"},table:{header:{timestamp:"Zeit",code:"Code",description:"Beschreibung",content:"Inhalt",priority:"Priorit√§t"},nodata:"Leider keine Ereignisse vorhanden!"}}};Vue.component("gc-messages",{props:{gcWidgetId:{type:String,default:"messages1",required:!0},gcApikey:{type:String,default:"39553fb7-7f6f-4945-9b84-a4c8745bdbec"},gcHost:{type:String,default:"geocledian.com"},gcProxy:{type:String,default:void 0},gcApiBaseUrl:{type:String,default:"/agknow/api/v4"},gcApiSecure:{type:Boolean,default:!0},gcSelectedParcelId:{type:Number,default:-1},gcLayout:{type:String,default:"vertical"},gcAvailableOptions:{type:String,default:"widgetTitle"},gcWidgetCollapsed:{type:Boolean,default:!0},gcLanguage:{type:String,default:"en"}},template:'<div :id="this.gcWidgetId" class="">\n\n                <p :class="[\'gc-options-title\', \'is-size-6\', \'is-inline-block\', !gcWidgetCollapsed ? \'is-grey\' : \'is-orange\']" \n                  style="cursor: pointer; margin-bottom: 0.5em;"    \n                  v-on:click="toggleMessages" \n                  v-show="availableOptions.includes(\'widgetTitle\')">\n                    \x3c!--i class="fas fa-th fa-sm"></i --\x3e {{ $t(\'options.title\')}}\n                  <i :class="[!gcWidgetCollapsed ? \'\': \'is-active\', \'fas\', \'fa-angle-down\', \'fa-sm\']"></i>\n                </p>\n\n                \x3c!-- message container --\x3e\n                <div :class="[!gcWidgetCollapsed ? \'\': \'is-hidden\', layoutCSSMap[\'alignment\'][gcLayout]]" style="width: 100%; margin-bottom: 1em; margin-top: 1em;">\n                  <table class="table is-narrow is-fullwidth" v-model="messages" v-if="messages.length > 0">\n                    <thead class="is-size-7">\n                      <tr>\n                        <th style="white-space: nowrap; text-transform: capitalize;">{{$t(\'table.header.timestamp\')}}\n                          <span class="" style="white-space: nowrap;">\n                            <i class="fas fa-sort" style="cursor: pointer;" v-on:click="sortByAttribute(\'message_timestamp\')"></i>\n                          </span>\n                        </th>\n                        <th style="white-space: nowrap; text-transform: capitalize;">{{$t(\'table.header.code\')}}\n                          <span class="" style="white-space: nowrap;">\n                            <i class="fas fa-sort" style="cursor: pointer;" v-on:click="sortByAttribute(\'message_code\')"></i>\n                          </span>\n                        </th>\n                        <th style="white-space: nowrap; text-transform: capitalize;">{{$t(\'table.header.description\')}}\n                          <span class="" style="white-space: nowrap;">\n                            <i class="fas fa-sort" style="cursor: pointer;" v-on:click="sortByAttribute(\'message_description\')"></i>\n                          </span>\n                        </th>\n                        <th style="white-space: nowrap; text-transform: capitalize;">{{$t(\'table.header.content\')}}\n                          <span class="" style="white-space: nowrap;">\n                            <i class="fas fa-sort" style="cursor: pointer;" v-on:click="sortByAttribute(\'message_content\')"></i>\n                          </span>\n                        </th>\n                        <th style="white-space: nowrap; text-transform: capitalize;">{{$t(\'table.header.priority\')}}\n                          <span class="" style="white-space: nowrap;">\n                            <i class="fas fa-sort" style="cursor: pointer;" v-on:click="sortByAttribute(\'message_priority\')"></i>\n                          </span>\n                        </th>\n                      </tr>\n                    </thead>\n                    <tbody class="content is-small">\n                      <tr v-for="m in messages">\n                        <td><span class="is-small">{{m.message_timestamp}}</span></td>\n                        <td><span class="is-small">{{m.message_code}}</span></td>\n                        <td><span class="is-small">{{m.message_description}}</span></td>\n                        <td><span class="is-small">{{m.message_content}}</span></td>\n                        <td><span class="is-small">{{m.message_priority}}</span></td>\n                      </tr>\n                    </tbody>\n                  </table>\n                  <div class="notification is-large is-grey" v-else>{{$t(\'table.nodata\')}}</div>\n                </div>\n\n            </div>\x3c!-- gcWidgetId --\x3e',data:function(){return console.debug("parceldata! - data()"),{messages:[],lastSortOrder:!1,layoutCSSMap:{alignment:{vertical:"is-inline-block",horizontal:"is-flex"}}}},i18n:{locale:this.currentLanguage,messages:gcMessagesLocales},created:function(){console.debug("messages! - created()"),this.changeLanguage()},mounted:function(){console.debug("messages! - mounted()");try{this.changeLanguage()}catch(ex){}},computed:{apiKey:{get:function(){return this.gcApikey}},apiHost:{get:function(){return this.gcHost}},apiBaseUrl:{get:function(){return this.gcApiBaseUrl}},apiSecure:{get:function(){return this.gcApiSecure}},apiMajorVersion:{get(){return"/agknow/api/v3"===this.apiBaseUrl?3:"/agknow/api/v4"===this.apiBaseUrl?4:void 0}},selectedParcelId:{get:function(){return this.gcSelectedParcelId}},availableOptions:{get:function(){return this.gcAvailableOptions.split(",")}},currentLanguage:{get:function(){return this.gcLanguage}}},watch:{currentLanguage(newValue,oldValue){this.changeLanguage()},selectedParcelId(newValue,oldValue){0==this.gcWidgetCollapsed&&this.getParcelMessages(newValue)},gcWidgetCollapsed(newValue,oldValue){0==newValue&&this.getParcelMessages(this.selectedParcelId)}},methods:{getApiUrl:function(endpoint){let protocol="http";return this.apiSecure&&(protocol+="s"),this.gcProxy?protocol+"://"+this.gcProxy+this.apiBaseUrl+endpoint:protocol+"://"+this.gcHost+this.apiBaseUrl+endpoint+"?key="+this.apiKey},getParcelMessages(parcel_id){if(!parcel_id||parcel_id<0)return;const endpoint="/parcels/"+parcel_id+"/messages";console.debug("getParcelMessages()"),console.debug("GET "+this.getApiUrl(endpoint)),axios({method:"GET",url:this.getApiUrl(endpoint)}).then(function(response){if(200===response.status){var tmp=response.data;let obj,resultNotEmpty;3===this.apiMajorVersion&&(console.debug(this.apiMajorVersion),resultNotEmpty=tmp.content.length>0,obj=tmp.content[0]),4===this.apiMajorVersion&&(obj=tmp.content,resultNotEmpty=void 0!==obj),resultNotEmpty&&(console.debug(tmp),this.messages=tmp.content)}else console.log(response)}.bind(this)).catch(err=>{console.log("err= "+err)})},toggleMessages(){this.gcWidgetCollapsed=!this.gcWidgetCollapsed},changeLanguage(){this.$i18n.locale=this.currentLanguage},sortByAttribute:function(attribute){console.debug("sorting by "+attribute),this.lastSortOrder=!this.lastSortOrder,this.messages.sort(function(a,b){return this.lastSortOrder?a[attribute]===Object(a[attribute])?JSON.stringify(a[attribute])>JSON.stringify(b[attribute])?-1:JSON.stringify(a[attribute])<JSON.stringify(b[attribute])?1:0:a[attribute]>b[attribute]?-1:a[attribute]<b[attribute]?1:0:a[attribute]===Object(a[attribute])?JSON.stringify(a[attribute])>JSON.stringify(b[attribute])?1:JSON.stringify(a[attribute])<JSON.stringify(b[attribute])?-1:0:a[attribute]>b[attribute]?1:a[attribute]<b[attribute]?-1:0}.bind(this)),this.$forceUpdate()},formatDate(timestamp){let time=timestamp.split("T")[0],date;return timestamp.split("T")[1]+"-"+time}}});